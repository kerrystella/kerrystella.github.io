<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"luischen.gitee.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="问题描述工业场景中，时序数据的可视化是一个无法回避的话题。时序数据的超大数据量给图形的展示性能带来了挑战，而通过降采样的方式减少图形的展示点数来迎合性能的同时，又会带来算法复杂度、算法可伸缩以及正确性等多方面的权衡。 下面通过几种常用的可视化降采样算法的研究和实践对比，为时序数据的可视化降采样算法选择提供参考。我们使用实际生产中的一个案例作为算法描述的基础：需求将10w点降采样到4000，以适配页">
<meta property="og:type" content="article">
<meta property="og:title" content="时序数据可视化的降采样算法">
<meta property="og:url" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/index.html">
<meta property="og:site_name" content="路易斯小屋">
<meta property="og:description" content="问题描述工业场景中，时序数据的可视化是一个无法回避的话题。时序数据的超大数据量给图形的展示性能带来了挑战，而通过降采样的方式减少图形的展示点数来迎合性能的同时，又会带来算法复杂度、算法可伸缩以及正确性等多方面的权衡。 下面通过几种常用的可视化降采样算法的研究和实践对比，为时序数据的可视化降采样算法选择提供参考。我们使用实际生产中的一个案例作为算法描述的基础：需求将10w点降采样到4000，以适配页">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/mseb1.png">
<meta property="og:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/mseb2.png">
<meta property="og:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/mseb3.png">
<meta property="og:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/ltd1.png">
<meta property="og:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/conclusion.png">
<meta property="og:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/result.png">
<meta property="article:published_time" content="2022-05-31T06:21:12.000Z">
<meta property="article:modified_time" content="2022-05-31T07:05:38.297Z">
<meta property="article:author" content="Luis Chen">
<meta property="article:tag" content="算法">
<meta property="article:tag" content="可视化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/mseb1.png">


<link rel="canonical" href="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/","path":"2022/05/31/时序数据可视化的降采样算法/","title":"时序数据可视化的降采样算法"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>时序数据可视化的降采样算法 | 路易斯小屋</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">路易斯小屋</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E8%A7%89%E5%88%86%E6%A1%B6%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">直觉分桶算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mode-Median-Bucket"><span class="nav-number">2.1.</span> <span class="nav-text">Mode-Median-Bucket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Min-Std-Error-Bucket"><span class="nav-number">2.2.</span> <span class="nav-text">Min-Std-Error-Bucket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Longest-Line-Bucket"><span class="nav-number">2.3.</span> <span class="nav-text">Longest-Line-Bucket</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B6%E5%9B%BE%E6%B3%9B%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="nav-number">3.</span> <span class="nav-text">制图泛化技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Douglas-Peucker-algorithm"><span class="nav-number">3.1.</span> <span class="nav-text">Douglas-Peucker algorithm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Visvalingam%E2%80%93Whyatt-algorithm"><span class="nav-number">3.2.</span> <span class="nav-text">Visvalingam–Whyatt algorithm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Largest-Triangle-Algorithms"><span class="nav-number">4.</span> <span class="nav-text">Largest Triangle Algorithms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Largest-Triangle-One-Bucket"><span class="nav-number">4.1.</span> <span class="nav-text">Largest-Triangle-One-Bucket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Largest-Triangle-Three-Buckets"><span class="nav-number">4.2.</span> <span class="nav-text">Largest-Triangle-Three-Buckets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Largest-Triangle-Dynamic"><span class="nav-number">4.3.</span> <span class="nav-text">Largest-Triangle-Dynamic</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E5%9B%9E%E9%A1%BE"><span class="nav-number">5.</span> <span class="nav-text">总结回顾</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Luis Chen"
      src="/uploads/%E8%AF%81%E4%BB%B6%E7%85%A72.jpg">
  <p class="site-author-name" itemprop="name">Luis Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/%E8%AF%81%E4%BB%B6%E7%85%A72.jpg">
      <meta itemprop="name" content="Luis Chen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="路易斯小屋">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="时序数据可视化的降采样算法 | 路易斯小屋">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          时序数据可视化的降采样算法
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-31 14:21:12 / 修改时间：15:05:38" itemprop="dateCreated datePublished" datetime="2022-05-31T14:21:12+08:00">2022-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">技术总结</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>工业场景中，时序数据的可视化是一个无法回避的话题。时序数据的超大数据量给图形的展示性能带来了挑战，而通过降采样的方式减少图形的展示点数来迎合性能的同时，又会带来算法复杂度、算法可伸缩以及正确性等多方面的权衡。</p>
<p>下面通过几种常用的可视化降采样算法的研究和实践对比，为时序数据的可视化降采样算法选择提供参考。我们使用实际生产中的一个案例作为算法描述的基础：需求将10w点降采样到4000，以适配页面的展示效果。</p>
<span id="more"></span>

<h2 id="直觉分桶算法"><a href="#直觉分桶算法" class="headerlink" title="直觉分桶算法"></a>直觉分桶算法</h2><p>在一般情况下，面对一个复杂问题最先起作用的往往是我们的直觉。所以在面对大数据集降采样的问题时最先想到的这类算法统称之为直觉算法。</p>
<h3 id="Mode-Median-Bucket"><a href="#Mode-Median-Bucket" class="headerlink" title="Mode-Median-Bucket"></a>Mode-Median-Bucket</h3><p>模式中位数分桶算法，从大类来看是一个分桶算法，从取样方式来看分成了众数取样和中位数取样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">首先确定桶的数量即threshold等于4000，那么被分配到每个桶的数据点就是25。</span><br><span class="line">遍历每个桶：</span><br><span class="line">	查看桶中是否存在唯一众数，如果存在则应用众数模式，选取众数的最左边点作为桶的代表点</span><br><span class="line">	如果不满足众数模式，则选取桶内点的中位数作为桶的代表点</span><br><span class="line"></span><br><span class="line">作为特殊考虑，如果是第一个桶则选取第一个点，最后一个桶则选取最后一个点，从而确保整个数据集的趋势完整性。</span><br></pre></td></tr></table></figure>

<h3 id="Min-Std-Error-Bucket"><a href="#Min-Std-Error-Bucket" class="headerlink" title="Min-Std-Error-Bucket"></a>Min-Std-Error-Bucket</h3><p>最小标准误差分桶算法，从大类来看是一个分桶算法，从取样方式来看基于线性回归采用标准误差（SEE - standard error of estimate）公式作为取样的依据。</p>
<img src="mseb1.png" />

<img src="mseb2.png" />

<img src="mseb3.png" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">首先确定桶的数量即threshold等于4000，首尾两个桶都只包含一个点确保数据集的起点和终点被选中，其他点平均分配到桶。</span><br><span class="line"></span><br><span class="line">1， 将每个桶中的点和后一个桶的点两两连成线段，每个线段记为一条边</span><br><span class="line">2， 对于每条边，计算所有x方向穿过的点到边的距离e</span><br><span class="line">3， 通过这些距离结合SEE公式计算边的标准误差作为边的权重</span><br><span class="line"></span><br><span class="line">至此，我们得到了一组带权重的边构成的DAG有向无环。</span><br><span class="line">只需要使用图的最短路径算法（如Dijkstra’s algorithm）就可以得到构成最短标准误差的那些点了。</span><br></pre></td></tr></table></figure>

<p>算法的主要缺陷在于选取最小标准误差的时候总是将图形变的平滑，所以局部的极值和全局的极值总是被忽略。</p>
<h3 id="Longest-Line-Bucket"><a href="#Longest-Line-Bucket" class="headerlink" title="Longest-Line-Bucket"></a>Longest-Line-Bucket</h3><p>最长线段分桶算法，相对于MSEB算法保留了局部极值和全局极值，算法过程类似。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1， 将每个桶的点和下一个桶的点两两连线段，每个线段记为一条边</span><br><span class="line">2， 计算每个边的长度，记为边的权重</span><br><span class="line"></span><br><span class="line">至此，我们得到了一组带权重的边构成的DAG，需要计算图的最大路径。</span><br><span class="line">由于路径的权重都是正值，所以可以简单的取反转换为计算图的最短路径问题。</span><br></pre></td></tr></table></figure>

<h2 id="制图泛化技术"><a href="#制图泛化技术" class="headerlink" title="制图泛化技术"></a>制图泛化技术</h2><p>上面描述的三个直觉算法一定程度上都能够解决问题，然而又或多或少引入了新的问题。比如MMB可能带来短视的问题，MSEB和LLB引入了额外的复杂度和效率问题。我们参考了几个制图泛化的技术，对直觉分桶算法进行改进。</p>
<h3 id="Douglas-Peucker-algorithm"><a href="#Douglas-Peucker-algorithm" class="headerlink" title="Douglas-Peucker algorithm"></a>Douglas-Peucker algorithm</h3><p>多边形逼近算法，通过递归来逐步逼近原图形效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">首先定义一个threshold（注意这个threshold和桶没有关系）表示点到线段的最大距离。</span><br><span class="line"></span><br><span class="line">1，	连接首尾点构成初始线段AB</span><br><span class="line">2，	计算AB中间的所有点到AB的垂直距离，获取垂直距离最大的点C和垂直距离e</span><br><span class="line">3，	如果e &lt;= threshold，则AB符合原图趋势，选择AB代表图形，AB中所有点都可以排除</span><br><span class="line">4，	如果e &gt; threshold，则AB不符合趋势，分别连接AC，CB，继续步骤2</span><br><span class="line">5，	如果AB中间已经没有其他点了，则递归结束</span><br></pre></td></tr></table></figure>

<h3 id="Visvalingam–Whyatt-algorithm"><a href="#Visvalingam–Whyatt-algorithm" class="headerlink" title="Visvalingam–Whyatt algorithm"></a>Visvalingam–Whyatt algorithm</h3><p>算法的主要思想是基于点的重要性或者意义来寻找能够代表图形的特征点，而点的重要性是通过有效区域即点构成三角形的面积来判定。</p>
<p>遍历数据集中的每一个点，将该点和邻近的两个点来构成三角形，三角形的区域即为点的有效区域。当有效区域较小时，认定该点对于图形的重要性较低。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1，	首先计算每个点的有效区域，找出有效区域最小的点，剔除；</span><br><span class="line">2，	重新计算邻接点的有效区域，继续找出有效区域最小的点，剔除；</span><br><span class="line">3，	重复步骤2，直到剩余点的个数满足了绘图要求，算法结束</span><br></pre></td></tr></table></figure>

<p>上面两种绘图泛化技术的特点是比较简单并且在降低数据量方面表现的相当有效。缺点是基于全局的返回可能会损失局部的特点，比如whyatt算法在删除点方面，可能会把一段时间的数据全部删除，这就给人造成了数据缺失的错觉，相应的图形表现力也大打折扣。如下图所示，黑色图形是算法处理后的图形。</p>
<image src="whyatt1.png">

<h2 id="Largest-Triangle-Algorithms"><a href="#Largest-Triangle-Algorithms" class="headerlink" title="Largest Triangle Algorithms"></a>Largest Triangle Algorithms</h2><p>最大三角形算法是结合了Whytt算法和直觉算法的改良版，通过三角形来形成有效区域从而对数据点的重要性进行量化，再结合直觉算法中分桶思想最大程度的保留图形的特点。</p>
<h3 id="Largest-Triangle-One-Bucket"><a href="#Largest-Triangle-One-Bucket" class="headerlink" title="Largest-Triangle-One-Bucket"></a>Largest-Triangle-One-Bucket</h3><p>LTOB最大三角形单桶算法，使用了Whytt算法有效区域的思路，再结合直觉算法中的分桶。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,	首先确定桶的大小，并将数据点平分到桶中，注意首尾点各占一个桶确保选中</span><br><span class="line">2,	依次计算每个点和邻接点形成的有效区域，去除无有效区域的点</span><br><span class="line">3,	在每个桶中选取有效区域最大的点代表当前桶</span><br></pre></td></tr></table></figure>

<p>LTOB算法相比原始的Whytt算法，确保了点分布的相对均匀。每个桶都有一个代表点来表示，从而连接成为一个全局的路由。</p>
<h3 id="Largest-Triangle-Three-Buckets"><a href="#Largest-Triangle-Three-Buckets" class="headerlink" title="Largest-Triangle-Three-Buckets"></a>Largest-Triangle-Three-Buckets</h3><p>LTTB最大三角形三桶算法，相比于单桶的短视问题，将有效区域的计算延伸到前后两个桶。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1，	首先确定桶的大小，并将数据点平分到桶中，注意首尾点各占一个桶确保选中</span><br><span class="line">2，	选中第一个点</span><br><span class="line">3，	从第二个桶开始，遍历桶中的点，计算每个点的有效区域，并选取有效区域最大的点作为桶的代表点。</span><br><span class="line">	三角形的选取为	[前一个桶的选中点，当前点，后一个桶的平均点]。</span><br><span class="line">4，	选中最后一个点</span><br></pre></td></tr></table></figure>

<p>LTTB算法相比LTOB算法，一定程度上减轻了短视的问题。同时通过固定三角形的两个点的方式，提升了算法的效率。</p>
<h3 id="Largest-Triangle-Dynamic"><a href="#Largest-Triangle-Dynamic" class="headerlink" title="Largest-Triangle-Dynamic"></a>Largest-Triangle-Dynamic</h3><p>LTD动态最大三角形，正如名字所说的那样可以动态的决定桶中的数据点个数。在上面提到的所有分桶算法中，我们都使用了同样的分配算法，即首尾各占一个桶，其他均分。这种分配方法无疑是最简单的，并且大多数情况是有效的。</p>
<p>但是当我们遇到一些特殊形状的图形，如数据分布不均匀，一部分时间数据变化很平缓，部分时间变化很陡峭，如下图所示。我们的分桶方式就会显得力不从心。</p>
<img src="ltd1.png">

<p>这时候就需要一个动态的的分桶算法，当数据平缓的时候桶中的点相对较多，当数据陡峭的时候桶中的点相对较少，以此来确保在平缓区域分配较少的桶来选取较少的点，而在陡峭区域分配较多的桶来选取较多的点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1,	首先确定桶的大小，并将数据点平分到桶中，注意首尾点各占一个桶确保选中</span><br><span class="line">2,	计算每一个桶的SSE（计算当前桶加上两个邻接点的线性回归线，SSE=桶内所有点到回归线的垂直距离平方之和）</span><br><span class="line">3,	循环迭代直至终止条件触发（一般为有限次的迭代total/threshold*10，案例中为250次）</span><br><span class="line">    	找出最大SSE的桶 F</span><br><span class="line">    	找出SSE之和最小的相邻桶 A 和 B（AB和F不能相同）</span><br><span class="line">    	将F均匀拆分成两个桶</span><br><span class="line">    	将AB合并为一个桶</span><br><span class="line">4,	确定了桶之后即可以采用LTTB算法进行降采样</span><br></pre></td></tr></table></figure>

<p>LTD算法相比LTTB算法在不规则图形上有更好的表现力，但是在规则图形上可能还不如LTTB。LTD的效率显然远不如LTTB，同时循环迭代的终止条件并没有比较好的参考数据需要不断尝试，这在某种程度上增加了算法的复杂性。</p>
<h2 id="总结回顾"><a href="#总结回顾" class="headerlink" title="总结回顾"></a>总结回顾</h2><p>在完成了以上六个算法的研究学习之后，我们可以对各个算法的优劣进行定性的比较，为我们之后的工作提供指导和帮助。</p>
<p>参照的指标有以下几个：</p>
<ul>
<li>速度（Speed），算法的运行速度无疑是很重要的因素，一般我们页面的的响应需要控制在3s以内，算法的速度也应该参考这个基准</li>
<li>可伸缩（Scalability），当数据量持续增长的时候，算法的表现不应发生明显变化</li>
<li>复杂性（Complexity），算法的复杂度在于理解和实现的难度，一个量化的直接就是LOC即实现的代码行</li>
<li>适配能力（Portability），算法在各个环境和语言中支持的程度</li>
<li>正确性（Correctness），算法的运行结果对于原图形的表现力</li>
</ul>
<img src="conclusion.png"/>

<p>从上图可以看出LTTB算法在绝大多数情况下都是表现优异的，当然基于场景的差异可能其他算法会有更好的正确性。所以我们的决策顺序可以是优先LTTB，当LTTB不满足呈现的需求时，我们可以尝试其他算法以获取更好的结果。</p>
<p>最后我们基于我们实际的两组数据进行了测试，一组为单调递增的累积损伤数据，一组为波动的异常诊断数据。</p>
<img src="result.png" />

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Luis Chen
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://luischen.gitee.io/2022/05/31/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E9%99%8D%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95/" title="时序数据可视化的降采样算法">https://luischen.gitee.io/2022/05/31/时序数据可视化的降采样算法/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E7%AE%97%E6%B3%95/" rel="tag"># 算法</a>
              <a href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag"># 可视化</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/27/%E4%B8%BA%E4%BB%80%E4%B9%88Java%E4%B8%AD%E7%9A%84String%E8%AE%BE%E8%AE%A1%E6%88%90%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%9A%84/" rel="prev" title="为什么Java中的String设计成不可变的">
                  <i class="fa fa-chevron-left"></i> 为什么Java中的String设计成不可变的
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/06/01/InfluxDB%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%85%A5MQTT/" rel="next" title="InfluxDB数据接入MQTT">
                  InfluxDB数据接入MQTT <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Luis Chen</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">30k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">27 分钟</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
